/*1.2.1*/
SELECT DISTINCT
SEQ.materia AS MATERIA,
CONCAT(', MAX(CASE WHEN SEQ.MATERIA=''',SEQ.MATERIA,''' THEN TV.SIGLA END) AS "',SEQ.MATERIA,'"') AS TEXTO
FROM base_senado.voto VT
INNER JOIN base_senado.senador SEN ON VT.idSENADOR = SEN.idSENADOR
INNER JOIN base_senado.sequencia SEQ ON VT.idSEQUENCIA = SEQ.idSEQUENCIA
INNER JOIN base_senado.tipo_voto TV ON VT.idTIPO_VOTO = TV.idTIPO_VOTO
INNER JOIN base_senado.tipo_sessao TS ON SEQ.TIPO_SESSAO = TS.idTIPO_SESSAO
WHERE TS.idTIPO_SESSAO IN (1, 3) /*Filtro para selecionar apenas proposicoes que foram normais e complementares e nao secretas*/
AND SEQ.RESULTADO IN ('Aprovado', 'Rejeitado') /*Filtro para selecionar apenas proposicoes que foram aprovadas e rejeitadas*/
AND TV.idTIPO_VOTO IN (2, 5, 15, 16) /*Filtro para selecionar apenas votos especificos*/
/*AND SUBSTRING(SEQ.DATA,1,7) BETWEEN '2015-01' AND '2016-08' /*Filtro para selecionar a data do pre ou pos impeachment*/
/*AND SUBSTRING(SEQ.DATA,1,7) BETWEEN '2016-09' AND '2017-12' /*Filtro para selecionar a data do pre ou pos impeachment*/
ORDER BY 1, 2;


SELECT
CONCAT(SEN.nome,' - ',SEN.partido,'/',SEN.UF) AS SENADOR

/*Copia e cola o retorno do resultado da coluna TEXTO da query anterior para gerar a transposicao de linhas para colunas, como no exemplo abaixo*/
, MAX(CASE WHEN SEQ.MATERIA='DEN 00001/2016' THEN TV.SIGLA END) AS "DEN 00001/2016"
, MAX(CASE WHEN SEQ.MATERIA='MPV 00663/2014' THEN TV.SIGLA END) AS "MPV 00663/2014"
, MAX(CASE WHEN SEQ.MATERIA='MPV 00664/2014' THEN TV.SIGLA END) AS "MPV 00664/2014"
, MAX(CASE WHEN SEQ.MATERIA='MPV 00665/2014' THEN TV.SIGLA END) AS "MPV 00665/2014"
, MAX(CASE WHEN SEQ.MATERIA='MPV 00672/2015' THEN TV.SIGLA END) AS "MPV 00672/2015"
, MAX(CASE WHEN SEQ.MATERIA='MPV 00677/2015' THEN TV.SIGLA END) AS "MPV 00677/2015"
, MAX(CASE WHEN SEQ.MATERIA='MPV 00678/2015' THEN TV.SIGLA END) AS "MPV 00678/2015"
, MAX(CASE WHEN SEQ.MATERIA='MPV 00688/2015' THEN TV.SIGLA END) AS "MPV 00688/2015"
, MAX(CASE WHEN SEQ.MATERIA='MPV 00692/2015' THEN TV.SIGLA END) AS "MPV 00692/2015"
, MAX(CASE WHEN SEQ.MATERIA='MPV 00693/2015' THEN TV.SIGLA END) AS "MPV 00693/2015"
, MAX(CASE WHEN SEQ.MATERIA='MPV 00696/2015' THEN TV.SIGLA END) AS "MPV 00696/2015"
, MAX(CASE WHEN SEQ.MATERIA='OFS 00088/2015' THEN TV.SIGLA END) AS "OFS 00088/2015"
, MAX(CASE WHEN SEQ.MATERIA='PDS 00347/2015' THEN TV.SIGLA END) AS "PDS 00347/2015"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00003/2016' THEN TV.SIGLA END) AS "PEC 00003/2016"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00007/2015' THEN TV.SIGLA END) AS "PEC 00007/2015"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00030/2014' THEN TV.SIGLA END) AS "PEC 00030/2014"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00031/2016' THEN TV.SIGLA END) AS "PEC 00031/2016"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00032/2010' THEN TV.SIGLA END) AS "PEC 00032/2010"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00033/2014' THEN TV.SIGLA END) AS "PEC 00033/2014"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00040/2011' THEN TV.SIGLA END) AS "PEC 00040/2011"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00043/2012' THEN TV.SIGLA END) AS "PEC 00043/2012"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00074/2013' THEN TV.SIGLA END) AS "PEC 00074/2013"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00078/2013' THEN TV.SIGLA END) AS "PEC 00078/2013"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00084/2015' THEN TV.SIGLA END) AS "PEC 00084/2015"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00098/2015' THEN TV.SIGLA END) AS "PEC 00098/2015"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00099/2015' THEN TV.SIGLA END) AS "PEC 00099/2015"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00113/2015' THEN TV.SIGLA END) AS "PEC 00113/2015"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00128/2015' THEN TV.SIGLA END) AS "PEC 00128/2015"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00133/2015' THEN TV.SIGLA END) AS "PEC 00133/2015"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00143/2015' THEN TV.SIGLA END) AS "PEC 00143/2015"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00152/2015' THEN TV.SIGLA END) AS "PEC 00152/2015"
, MAX(CASE WHEN SEQ.MATERIA='PEC 00159/2015' THEN TV.SIGLA END) AS "PEC 00159/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00002/2015' THEN TV.SIGLA END) AS "PLC 00002/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00007/2016' THEN TV.SIGLA END) AS "PLC 00007/2016"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00015/2015' THEN TV.SIGLA END) AS "PLC 00015/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00023/2015' THEN TV.SIGLA END) AS "PLC 00023/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00026/2015' THEN TV.SIGLA END) AS "PLC 00026/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00057/2015' THEN TV.SIGLA END) AS "PLC 00057/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00075/2015' THEN TV.SIGLA END) AS "PLC 00075/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00101/2015' THEN TV.SIGLA END) AS "PLC 00101/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00125/2015' THEN TV.SIGLA END) AS "PLC 00125/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00167/2015' THEN TV.SIGLA END) AS "PLC 00167/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLC 00186/2015' THEN TV.SIGLA END) AS "PLC 00186/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00078/2015' THEN TV.SIGLA END) AS "PLS 00078/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00130/2014' THEN TV.SIGLA END) AS "PLS 00130/2014"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00131/2015' THEN TV.SIGLA END) AS "PLS 00131/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00141/2014' THEN TV.SIGLA END) AS "PLS 00141/2014"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00201/2013' THEN TV.SIGLA END) AS "PLS 00201/2013"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00274/2015' THEN TV.SIGLA END) AS "PLS 00274/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00316/2015' THEN TV.SIGLA END) AS "PLS 00316/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00375/2011' THEN TV.SIGLA END) AS "PLS 00375/2011"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00389/2015' THEN TV.SIGLA END) AS "PLS 00389/2015"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00400/2014' THEN TV.SIGLA END) AS "PLS 00400/2014"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00477/2011' THEN TV.SIGLA END) AS "PLS 00477/2011"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00501/2013' THEN TV.SIGLA END) AS "PLS 00501/2013"
, MAX(CASE WHEN SEQ.MATERIA='PLS 00525/2015' THEN TV.SIGLA END) AS "PLS 00525/2015"
, MAX(CASE WHEN SEQ.MATERIA='PRS 00029/2016' THEN TV.SIGLA END) AS "PRS 00029/2016"
, MAX(CASE WHEN SEQ.MATERIA='SCD 00005/2015' THEN TV.SIGLA END) AS "SCD 00005/2015"
FROM base_senado.voto VT
INNER JOIN base_senado.senador SEN ON VT.idSENADOR = SEN.idSENADOR
INNER JOIN base_senado.sequencia SEQ ON VT.idSEQUENCIA = SEQ.idSEQUENCIA
INNER JOIN base_senado.tipo_voto TV ON VT.idTIPO_VOTO = TV.idTIPO_VOTO
INNER JOIN base_senado.tipo_sessao TS ON SEQ.TIPO_SESSAO = TS.idTIPO_SESSAO
WHERE TV.idTIPO_VOTO IN (2, 5, 15, 16) /*Filtro para selecionar apenas votos especificos*/
GROUP BY SEN.NOME
ORDER BY SEN.NOME;